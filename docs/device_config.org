*  设备配置流程
 设备通过配置可以连入网络，并连接上平台。
具体设备配置的操作是：进入到配置模式（在 app 模式下，长按侧边模式键 3 秒，出现红灯长亮松开按键，设备会进入到红灯闪烁的配置状态），使用手机进行配置。

设备 board 意义：
| Product | 出厂灌入秘钥 | 出厂未灌入秘钥 |
|---------+--------------+----------------|
| atom    | 888000       | 887000         |
| neutron | 888001       | 887001         |
| nut     | 888002       | 887002         |

at_mode 意义：
at_mode = 1 : 设备已经有 deviec_id 和 access_token
at_mode = 0 : 设备没有 access_token

#+begin_src ditaa :file device_config.png :cmdline -r -s 0.8

                                                 +----------+
                                                 |          |
                                                 | 配置开始 |
                                                 |   cRED   |
                                                 +-----+----+
                                                       |
                                                       |
                                                       V
                                                 +-----+--------------+
                                                 |                    |
                                                 | 核心板进入配置模式 | manage_setup_config();
                                                 |                    |
                                                 |   cRED             |
                                                 +-----+--------------+
                                                       |
                                                       |
                                                       V
                                                 +-----+-------------+
                                                 |                   |
                                                 | Imlink 配置 WiFi  | wlan_Imlink_start();
                                       +-------->+                   |
                                       |         |   cRED            |
                                       |         +-----+-------------+
                                       |               |
                                      否               |
                                       |               V
                                       |         +-----+-----+
                                       |         |           |
                                       +---------+   成功    |
                                                 |           | DeviceConfig::process();
                                                 |   cRED    |
                                                 +-----+-----+
                                                       |
                                                       是
                                                       |
                                                       V
                                                 +-----+----------------------------+
                                                 |                                  |
                                                 | 手机发送“检测设备”指令           |
                                                 | 发送:{ "command": "hello"}       | getDeviceBaseInfo();
                                                 | 接收:{ "status":200,"board":     |
                                                 | "88x00x", "device_id":           |
                                                 | "88x00xxxxxxxxxxxxxxxxxxx",      |
                                                 | "at_mode": x}                    |
                                                 |                                  |
                                                 |   cRED                           |
                                                 +-----+----------------------------+
                                                       |
                                                       |
                                                       V
                                                 +-----+----------------+
                         arduino 设备创建方式     |                      |  IntoRobot 设备创建方式
                                                 | at_mode 存在并且为 1 |
                +--------------否----------------+                      +--------------是----------------+
                |                                |   cRED               |                                |
                |                                +----------------------+                                |
                |                                                                                        |
                v                                                                                        v
  +-------------+-----------------------------------+                                     +--------------+----------------------------------+
  |   创建 arduino 设备                             |                                     |   手机发送“设备信息”指令                        |
  |   获取 physics_id 和 access_token               |                                     |   发送：{ "command": "sendDeviceInfo",          |
  |                                                 |                                     |           "value": {"zone": 8, "sv_domain":     |
  |                                                 |                                     |           "iot.intorobot.com", "sv_port": 1883, | setDeviceBoundInf(value_Object);
  |                                                 |                                     |           "dw_domain": "www.intorobot.com"}}    |
  |                                                 |                                     |   接收:{"status": 200}                          |
  |        cRED                                     |                                     |             cRED                                |
  +-------------+-----------------------------------+                                     +--------------+----------------------------------+
                |                                                                                        |
                v                                                                                        v
  +-------------+-----------------------------------+                                     +--------------+----------------------------------+
  |   手机发送“设备信息”指令                        |                                     |                                                 |
  |   发送：{ "command": "sendDeviceInfo",          |                                     |                                                 |
  |           "value": {                            |                                     |                                                 |
  |   "device_id": "88700xxxxxxxxxxxxxxxxxx",       |                                     |                                                 |
  |   "zone": 8, "sv_domain": "iot.intorobot.com",  | setDeviceBoundInfo(value_Object);   |         核心板连入 mqtt 服务器                  | g_mqtt_client.connect("", access_token, device_id)
  |   "sv_port": 1883,                              |                                     |                                                 | intorobot_publish(INTOROBOT_MQTT_VERSION_TOPIC,
  |   "dw_domain": "www.intorobot.com"}}            |                                     |                                                 |                   (uint8_t*) temp, strlen(temp), 0, true);
  |   接收:{"status": 200}                          |                                     |                                                 |
  |   设备端：at_mode=1                             |                                     |                                                 |
  |             cRED                                |                                     |            cRED                                 |
  +-------------+-----------------------------------+                                     +---------------+---------------------------------+
                |                                                                                         |
                |                                                                                         v
                |                                                                                  +------+------+
                |                                                                                  |             |
                |                                                                                  |设备是否在线 +----------------+
                |                                                                                  |             |                |
                |                                                                                  |   cRED      |                |
                |                                                                                  +-------+-----+                |
                |                                                                                          |                      |
                |                                                                                          |                      |
                |                                                                                          是                    否
                |                                                                                          |                      |
                |                                                                                          v                      |
                |                                                                                   +------+--------------+       |
                |                                                                                   |                     |       |
                |                                                                                   | 创建 IntoRobot 设备 |       |
                |                                                                                   |   并进行捆绑        |       |
                |                                                                                   |   cRED              |       |
                |                                                                                   +------+--------------+       |
                |                                                                                          |                      v
                |                                +-----------+                                             |                +-----+-----+
                |                                |           |                                             |                |           |
                |                                | 配置成功  |                                             |                | 配置失败  |
                +------------------------------->+           +<--------------------------------------------+                |           |
                                                 |   cRED    |                                                              |   cRED    |
                                                 +-----+-----+                                                              +-----+-----+
                                                       |                                                                          |
                                                       |                                                                          |
                                                       V                                                                          |
                                                 +-----------+                                                                    |
                                                 |           |                                                                    |
                                                 |   结束    |                                                                    |
                                                 |           +<-------------------------------------------------------------------+
                                                 |   cRED    |
                                                 +-----------+
#+end_src
